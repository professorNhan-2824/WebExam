<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quizz | Free Online Quizzes, Lessons</title>

  <!-- slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.1.3/assets/owl.carousel.min.css" />

  <!-- bootstrap core css -->
  <link rel="stylesheet" href="bootstrap.css">

  <!-- fonts style -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,600,700&display=swap" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="style.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">
  <!-- responsive style -->
  <link href="responsive.css" rel="stylesheet" />
  <style>
    .icon-container {
      background-color: #4b208c;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .data-card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
    }
    .test-name {
      font-size: 1.2rem;
      font-weight: 600;
    }
    .test-date {
      font-size: 0.9rem;
      color: #6c757d;
    }
    .btn-toggle {
      width: 100%;
      font-weight: bold;
    }
    .btn-toggle.active {
      background-color: #28a745 !important;
      color: white !important;
    }
    .btn-toggle.inactive {
      background-color: #6c757d !important;
      color: white !important;
    }
  </style>
</head>

<body class="sub_page">

  <div class="hero_area">
    <div th:replace="~{fragments/navbar :: header}"></div>
  </div>
<!--  <div class="search-box">-->
<!--    <form class="d-flex">-->
<!--      <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">-->
<!--      <button class="btn btn-primary btn-search" type="submit" style="background-color:#4b208c;">Search</button>-->
<!--    </form>-->
<!--  </div>-->
  <div class="search-box">
    <form class="d-flex" action="/library" method="get">
      <input class="form-control me-2" type="search" name="query" placeholder="Tìm kiếm bài kiểm tra (ID hoặc tên)" aria-label="Search">
      <button class="btn btn-primary btn-search" type="submit" style="background-color:#4b208c;">Search</button>
    </form>
  </div>
  <!-- service section -->
  <section class="service_section layout_padding d-flex justify-content-center">
    <div class="container">
      <div class="row">

        <div th:if="${#lists.isEmpty(examuser)}" class="d-block col-12">
          <h1 >Không có dữ liệu</h1> <br>
          <button type="button" class="btn w-20" style="background-color:#4b208c;"> <a style="color:#FFFFFF;" href="/createtest">Create Exam</a></button>
        </div>

        <div class="container d-block " th:if="${not #lists.isEmpty(examuser)}">
          <div th:each="exam : ${examuser}" class="mt-1 mb-2 data-card row align-items-center">
            <div class="col-3 d-flex justify-content-center">
              <div class="icon-container">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-alexa" viewBox="0 0 16 16">
                  <path d="M7.996 0A8 8 0 0 0 0 8a8 8 0 0 0 6.93 7.93v-1.613a1.06 1.06 0 0 0-.717-1.008A5.6 5.6 0 0 1 2.4 7.865 5.58 5.58 0 0 1 8.054 2.4a5.6 5.6 0 0 1 5.535 5.81l-.002.046-.012.192-.005.061a5 5 0 0 1-.033.284l-.01.068c-.685 4.516-6.564 7.054-6.596 7.068A7.998 7.998 0 0 0 15.992 8 8 0 0 0 7.996.001Z"/>
                </svg>
              </div>
            </div>

            <div class="col-7">
              <div class="row">
                <div class="col-12">
                  <h4 class="test-name" th:text="${exam.nameExam}">Tên test</h4>
                </div>
                <div class="col-12">
                  <p class="test-date" th:text="${exam.formattedDateExam}">Ngày thi</p> <br>
                  <p class="test-date" th:text="${exam.idExam}">ID</p>
                </div>
              </div>
            </div>

            <div class="col-2 d-flex flex-column align-items-center">
              <!-- Nút Check -->
              <button type="button" class="btn mb-2" style="background-color:#4b208c; color:white; width: 100%;">
                <a th:href="@{/example_1(IDexam=${exam.idExam}, NameExam=${exam.nameExam})}"
                   style="color:white; text-decoration: none;">
                  Check
                </a>
              </button>

              <!-- Nút Danh sách -->
              <button type="button" class="btn btn-secondary" style="color:white; width: 100%;">
                <a th:href="@{/make_exam/{idExam}(idExam=${exam.idExam})}"
                   style="color:white; text-decoration: none;">
                  Danh sách
                </a>
              </button>
              <button type="button" class="btn btn-toggle"
                      th:class="${exam.active} ? 'active' : 'inactive'"
                      th:text="${exam.active} ? 'On' : 'Off'"
                      th:attr="data-exam-id=${exam.idExam}, data-active=${exam.active}"
                      onclick="toggleExamStatus(this)">
              </button>
            </div>

          </div>
        </div>



          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- end service section -->


  <!-- info section -->

  <section class="info_section layout_padding">
    <div class="container">
      <div class="info_contact">
        <div class="row">
          <div class="col-md-4">
            <a href="">
              <img src="location-white.png" alt="">
              <span>
                Passages of Lorem Ipsum available
              </span>
            </a>
          </div>
          <div class="col-md-4">
            <a href="">
              <img src="telephone-white.png" alt="">
              <span>
                Call : +012334567890
              </span>
            </a>
          </div>
          <div class="col-md-4">
            <a href="">
              <img src="envelope-white.png" alt="">
              <span>
                demo@gmail.com
              </span>
            </a>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-8 col-lg-9">
          <div class="info_form">
            <form action="">
              <input type="text" placeholder="Enter your email">
              <button>
                subscribe
              </button>
            </form>
          </div>
        </div>
        <div class="col-md-4 col-lg-3">
          <div class="info_social">
            <div>
              <a href="">
                <img src="fb.png" alt="">
              </a>
            </div>
            <div>
              <a href="">
                <img src="twitter.png" alt="">
              </a>
            </div>
            <div>
              <a href="">
                <img src="linkedin.png" alt="">
              </a>
            </div>
            <div>
              <a href="">
                <img src="instagram.png" alt="">
              </a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>

  <!-- end info section -->

  <!-- footer section -->
  <footer class="container-fluid footer_section">
    <div class="container">
      <div class="row">
        <div class="col-lg-7 col-md-9 mx-auto">
          <p>
            &copy; 2019 All Rights Reserved By
            <a href="https://html.design/">Free Html Templates</a>
          </p>
        </div>
      </div>
    </div>
  </footer>
  <!-- footer section -->


  <script src="jquery-3.4.1.min.js"></script>
  <script src="bootstrap.js"></script>
  <script src="/js/jquery-3.4.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>
  <script>
    function toggleExamStatus(button) {
      const examId = button.getAttribute('data-exam-id');
      const currentActive = button.getAttribute('data-active') === 'true';
      const newActive = !currentActive;

      // Xác nhận trước khi thay đổi
      if (!confirm(`Bạn có muốn chuyển trạng thái bài thi sang ${newActive ? 'On' : 'Off'} không?`)) {
        return;
      }

      // Cập nhật giao diện nút
      button.textContent = newActive ? 'On' : 'Off';
      button.classList.remove(currentActive ? 'active' : 'inactive');
      button.classList.add(newActive ? 'active' : 'inactive');
      button.setAttribute('data-active', newActive);

      // Gửi yêu cầu đến backend
      fetch('/update-exam-status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          examId: examId,
          active: newActive
        })
      })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  alert('Cập nhật trạng thái bài thi thành công!');
                } else {
                  // Hoàn tác nếu thất bại
                  button.textContent = currentActive ? 'On' : 'Off';
                  button.classList.remove(newActive ? 'active' : 'inactive');
                  button.classList.add(currentActive ? 'active' : 'inactive');
                  button.setAttribute('data-active', currentActive);
                  alert('Cập nhật trạng thái thất bại: ' + (data.message || 'Lỗi không xác định'));
                }
              })
              .catch(error => {
                // Hoàn tác nếu lỗi
                button.textContent = currentActive ? 'On' : 'Off';
                button.classList.remove(newActive ? 'active' : 'inactive');
                button.classList.add(currentActive ? 'active' : 'inactive');
                button.setAttribute('data-active', currentActive);
                console.error('Lỗi:', error);
                alert('Có lỗi xảy ra khi cập nhật trạng thái.');
              });
    }
  </script>


</body>

</html>